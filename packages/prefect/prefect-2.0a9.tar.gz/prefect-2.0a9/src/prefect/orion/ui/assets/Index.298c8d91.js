import{e as H,f as q,s as n,j as L,B as _e,o as i,q as N,ad as de,ao as Q,r as I,c as v,d as t,a as r,w as d,D as X,af as Y,u as e,ap as pe,g as y,k as h,aq as fe,ar as me,as as ve,M as he,an as ge,C as we,am as be,t as x,ae as ye,J as xe,F as ke,p as Re,b as $e}from"./vendor.c935fcc5.js";import{A as k,E as $,_ as Te,s as Z,S as Ie,f as ee,t as Ce}from"./index.70d1c732.js";import{T as Fe}from"./Timeline.1f325415.js";import{R as Se,M as Be}from"./MiniRadar.5d853eff.js";import{C as qe}from"./CopyButton.fb955bcf.js";const Le=H({props:{id:{type:String,required:!0}},setup(p){const g=p,w=q(new Se),f=n(()=>({id:g.id})),u={radar:k.query({endpoint:$.radar,body:f,options:{pollInterval:5e3}})};return L(()=>{var l;return(l=u.radar.response)==null?void 0:l.value},l=>{l&&w.value.items(l)}),_e(()=>{w.value.id("id").dependencies("upstream_dependencies").items([])}),(l,j)=>(i(),N(Be,{id:p.id,radar:w.value,"hide-viewport":"","disable-interactions":""},null,8,["id","radar"]))}});const Ne={class:"flow-run-logs-tabs-content"},je={class:"flow-run-logs-tabs-content__header"},De=t("p",{class:"flow-run-logs-tabs-content__span"},"Showing: Start to Now",-1),Ee={class:"flow-run-logs-tab-content__table"},Me={class:"flow-run-logs-tab-content__table-header"},Ve=t("span",{class:"flow-run-logs-tab-content__column flow-run-logs-tab-content__column-run"}," Run name ",-1),Ae=t("span",{class:"flow-run-logs-tab-content__column flow-run-logs-tab-content__column--level"}," Level ",-1),Pe=t("span",{class:"flow-run-logs-tab-content__column flow-run-logs-tab-content__column--time"}," Time ",-1),Ue=t("span",{class:"flow-run-logs-tab-content__column flow-run-logs-tab-content__column--message"}," Message ",-1),He=h(" Copy Logs "),Ge={class:"flow-run_logs-tab-content__empty"},We=h(" No logs to show. "),Je=h(" Try clearing your filter "),Oe={key:0,class:"flow-run-logs-tabs-content__loading"},ze=H({props:{flowRunId:{type:String,required:!0},running:{type:Boolean}},setup(p){const g=p,w=q(),f=[{label:"Critical only",value:50},{label:"Error and above",value:40},{label:"Warning and above",value:30},{label:"Info and above",value:20},{label:"Debug and above",value:10},{label:"All log levels",value:0}],u=q(0),l=n(()=>({logs:{flow_run_id:{any_:[g.flowRunId]},level:{ge_:u.value}}})),j={interval:g.running?5e3:void 0},c=de(Q.filter.bind(Q),[l],j),D=n(()=>{var o;return(o=c.response.value)!=null?o:[]}),C=n(()=>{var o;return(o=c.loading.value)!=null?o:!0}),F=()=>{u.value=0},M=()=>{if(!w.value)return;const o=w.value,b=o.scrollTop>0,T=o.scrollTop+o.offsetHeight===o.scrollHeight;b&&T&&fe(()=>{o.scrollTop=o.scrollHeight})},V=()=>D.value.map(o=>{const b=me(o.level),T=ve(o.timestamp);return`${b}	${T}	${o.message}`}).join(`
`);return L(()=>g.running,()=>c.unsubscribe()),L(()=>c.response.value,()=>M()),(o,b)=>{const T=I("m-select"),a=I("Button"),A=I("m-loader");return i(),v("div",Ne,[t("div",je,[De,r(T,{modelValue:u.value,"onUpdate:modelValue":b[0]||(b[0]=R=>u.value=R),options:f,class:"flow-run-logs-tabs-content__filter"},null,8,["modelValue"])]),t("div",Ee,[t("div",Me,[Ve,Ae,Pe,Ue,r(qe,{value:V,toast:"Logs copied to clipboard"},{default:d(()=>[He]),_:1})]),t("div",{ref:(R,S)=>{S.logsRef=R,w.value=R},class:"flow-run-logs-tab-content__logs"},[r(e(pe),{logs:e(D)},{empty:d(()=>[t("p",Ge,[We,X(r(a,{class:"ml-2",onClick:F},{default:d(()=>[Je]),_:1},512),[[Y,u.value]])])]),_:1},8,["logs"]),p.running||e(C)?(i(),v("div",Oe,[r(A,{loading:!0,class:"flow-run-logs-tabs-content__loader"}),X(t("span",null,"Run in progress...",512),[[Y,p.running]])])):y("",!0)],512)])])}}});const E=p=>(Re("data-v-07d69322"),p=p(),$e(),p),Ke={class:"main-grid"},Qe={class:"d-flex align-center justify-space-between py-1 px-2"},Xe={class:"d-inline-flex flex-column"},Ye={class:"flex-grow-0 flex-shrink-1"},Ze={class:"d-inline-flex align-center text-truncate"},et={class:"caption font--primary font-weight-semibold text--grey-40 d-flex text-truncate"},tt={key:0},st=h(" Started: "),nt={class:"text--grey-80 mr-1 ml--half"},ot={key:1},lt=h(" Ended: "),at={class:"text--grey-80 mr-1 ml--half"},rt={class:"caption font--primary font-weight-semibold text--grey-40 mt-1 d-flex text-truncate"},ut={key:0},it=h(" Deployment: "),ct={class:"text--grey-80 mr-1 ml--half"},_t={key:1},dt=h(" Parent: "),pt={class:"text--grey-80"},ft=h(" /"),mt={key:2},vt=h(" Results: "),ht={class:"text--grey-80 mr-1 ml--half"},gt={key:3},wt=h(" Flow version: "),bt={class:"text--grey-80 mr-1 ml--half"},yt={class:"font--secondary"},xt={class:"d-flex align-center justify-space-between py-1 px-2"},kt=E(()=>t("div",{class:"subheader"},"Timeline",-1)),Rt={class:"timeline-content pb-2 px-2 d-flex flex-grow-1"},$t={class:"d-flex align-center justify-space-between py-1 px-2"},Tt=E(()=>t("div",{class:"subheader"},"Radar",-1)),It={class:"radar-content pb-2 px-2 d-flex flex-grow-1"},Ct={key:0,class:"font--secondary caption my-2",style:{"min-height":"17px"}},Ft={class:"results-section d-flex flex-column align-stretch justify-stretch"},St={class:"text-center my-8",key:"no-results"},Bt=E(()=>t("h2",null," No Results Found ",-1)),qt=[Bt],Lt=E(()=>t("hr",{class:"results-hr mt-3"},null,-1)),Nt=H({async setup(p){let g,w;const f=he(),u=q("task_runs"),l=q(f==null?void 0:f.params.id),j=n(()=>({id:l.value})),c=([g,w]=ge(()=>k.query({endpoint:$.flow_run,body:j,options:{pollInterval:5e3}}).fetch()),g=await g,w(),g),D=n(()=>c.response.value.flow_id),C=n(()=>c.response.value.parent_task_run_id),F=n(()=>c.response.value.deployment_id),M=n(()=>({id:D.value})),V=n(()=>({id:F.value})),o=n(()=>({task_runs:{id:{any_:[C.value]}}})),b=n(()=>({flow_runs:{id:{any_:[l.value]}}})),T=n(()=>({flow_runs:{id:{any_:[l.value]}},task_runs:{subflow_runs:{exists_:!0}}})),a={flow:k.query({endpoint:$.flow,body:M}),deployment:k.query({endpoint:$.deployment,body:V,options:{paused:!F.value}}),parent_flow:k.query({endpoint:$.flows,body:o,options:{paused:!C.value}}),parent_flow_run:k.query({endpoint:$.flow_runs,body:o,options:{paused:!C.value}}),task_runs_count:k.query({endpoint:$.task_runs_count,body:b,options:{pollInterval:1e4}}),task_runs:k.query({endpoint:$.task_runs,body:b,options:{pollInterval:1e4}}),sub_flow_runs_count:k.query({endpoint:$.task_runs_count,body:T,options:{pollInterval:1e4}})},A={task_runs:"task_runs_count",sub_flow_runs:"sub_flow_runs_count",logs:""},R=n(()=>{var s;return u.value&&((s=a[A[u.value]])==null?void 0:s.response)||0}),S=n(()=>{var s;return((s=a.deployment.response)==null?void 0:s.value)||{}}),G=n(()=>{var s,m;return((m=(s=a.parent_flow.response)==null?void 0:s.value)==null?void 0:m[0])||{}}),W=n(()=>{var s,m;return((m=(s=a.parent_flow_run.response)==null?void 0:s.value)==null?void 0:m[0])||{}}),J=n(()=>{var s,m;return(m=(s=S.value)==null?void 0:s.flow_data)==null?void 0:m.blob}),_=n(()=>{var s;return((s=c.response)==null?void 0:s.value)||{}}),te=n(()=>_.value.end_time),B=n(()=>{var s;return(s=_.value)==null?void 0:s.state}),se=n(()=>B.value.type=="RUNNING"),ne=n(()=>{var s;return((s=_.value)==null?void 0:s.tags)||[]}),oe=n(()=>{var s;return((s=a.task_runs_count.response)==null?void 0:s.value)||0}),le=n(()=>{var s;return((s=a.sub_flow_runs_count.response)==null?void 0:s.value)||0}),O=n(()=>{var s;return((s=a.task_runs.response)==null?void 0:s.value)||[]}),ae=n(()=>[{label:"Task Runs",href:"task_runs",count:oe.value,icon:"pi-task"},{label:"Subflow Runs",href:"sub_flow_runs",count:le.value,icon:"pi-flow-run"},{label:"Logs",href:"logs",icon:"pi-logs-fill"}]),re=n(()=>B.value.type=="PENDING"||B.value.type=="SCHEDULED"?"--":_.value.total_run_time?Z(_.value.total_run_time):Z(_.value.estimated_run_time));we(()=>{c.stopPolling(),k.queries.delete(c.id)});const ue=L(f,()=>{l.value=f==null?void 0:f.params.id});return be(()=>{ue()}),L(l,async()=>{!l.value||(await c.fetch(),a.flow.fetch(),a.task_runs_count.fetch(),a.task_runs.fetch(),a.sub_flow_runs_count.fetch(),F.value?a.deployment.fetch():a.deployment.clearResult(),C.value?a.parent_flow.fetch():a.parent_flow.clearResult(),C.value?a.parent_flow_run.fetch():a.parent_flow_run.clearResult(),u.value="task_runs")}),(s,m)=>{const ie=I("Tags"),P=I("router-link"),U=I("Card"),z=I("IconButton"),K=I("ResultsList");return i(),v(ke,null,[t("div",Ke,[r(U,{class:"details",shadow:"sm"},{default:d(()=>[t("div",Qe,[t("div",Xe,[t("div",Ye,[t("span",Ze,[r(Ie,{name:e(B).name,type:e(B).type,class:"mr-1"},null,8,["name","type"]),r(ie,{tags:e(ne),class:"mr-1 caption"},null,8,["tags"]),t("div",et,[e(_).start_time?(i(),v("span",tt,[st,t("span",nt,x(e(ee)(e(_).start_time)),1)])):y("",!0),e(_).end_time?(i(),v("span",ot,[lt,t("span",at,x(e(ee)(e(_).end_time)),1)])):y("",!0)])])]),t("div",rt,[e(S).name?(i(),v("span",ut,[it,t("span",ct,x(e(S).name),1)])):y("",!0),e(G).name?(i(),v("span",_t,[dt,t("span",pt,x(e(G).name),1),ft,r(P,{to:`/flow-run/${e(W).id}`,class:"mr-1 ml--half text--primary"},{default:d(()=>[h(x(e(W).name),1)]),_:1},8,["to"])])):y("",!0),e(J)?(i(),v("span",mt,[vt,t("span",ht,x(e(J)),1)])):y("",!0),e(_).flow_version?(i(),v("span",gt,[wt,t("span",bt,x(e(_).flow_version),1)])):y("",!0)])]),t("div",yt,x(e(re)),1)])]),_:1}),r(U,{class:"timeline d-flex flex-column",width:"auto",shadow:"sm"},{header:d(()=>[t("div",xt,[kt,r(P,{to:`/flow-run/${l.value}/timeline`},{default:d(()=>[r(z,{icon:"pi-full-screen"})]),_:1},8,["to"])])]),default:d(()=>[t("div",Rt,[e(O).length?(i(),N(Fe,{key:0,items:e(O),"max-end-time":e(te),"hide-header":"","axis-position":"bottom","background-color":"blue-5"},null,8,["items","max-end-time"])):y("",!0)])]),_:1}),r(U,{class:"radar",shadow:"sm"},{header:d(()=>[t("div",$t,[Tt,r(P,{to:`/flow-run/${l.value}/radar`},{default:d(()=>[r(z,{icon:"pi-full-screen"})]),_:1},8,["to"])])]),default:d(()=>[t("div",It,[r(Le,{id:l.value},null,8,["id"])])]),_:1})]),r(e(ye),{tab:u.value,"onUpdate:tab":m[0]||(m[0]=ce=>u.value=ce),tabs:e(ae),class:"mt-3"},null,8,["tab","tabs"]),e(R).value>0?(i(),v("div",Ct,[t("span",null,x(e(R).value.toLocaleString())+" "+x(e(Ce)("Result",e(R))),1)])):y("",!0),t("section",Ft,[r(xe,{name:"tab-fade",mode:"out-in",css:""},{default:d(()=>[e(R).value===0?(i(),v("div",St,qt)):u.value=="task_runs"?(i(),N(K,{key:"task_runs",filter:e(b),component:"list-item-task-run",endpoint:"task_runs","poll-interval":5e3},null,8,["filter"])):u.value=="sub_flow_runs"?(i(),N(K,{key:"sub_flow_runs",filter:e(T),component:"list-item-sub-flow-run",endpoint:"task_runs","poll-interval":5e3},null,8,["filter"])):u.value=="logs"?(i(),N(ze,{key:3,"flow-run-id":l.value,running:e(se)},null,8,["flow-run-id","running"])):y("",!0)]),_:1})]),Lt],64)}}});var At=Te(Nt,[["__scopeId","data-v-07d69322"]]);export{At as default};
