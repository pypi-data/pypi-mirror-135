"use strict";(self.webpackChunksparkmonitor=self.webpackChunksparkmonitor||[]).push([[2],{265:(e,t,a)=>{a.d(t,{S:()=>l});var s=a(271),n=a.n(s);class l extends n().Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){console.log("SparkMonitor: Caught react error:",e,t)}render(){return this.state.hasError?n().createElement("div",null,"Error: Something went wrong displaying this data."):this.props.children}}},2:(e,t,a)=>{a.r(t),a.d(t,{default:()=>R});var s=a(412),n=a(674),l=a(706),o=a(271),i=a.n(o),r=a(797);class c{constructor(e){Object.defineProperty(this,"notebookPanel",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"isReady",{enumerable:!0,configurable:!0,writable:!0,value:new r.PromiseDelegate}),Object.defineProperty(this,"cellSlotMap",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"activeCell",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lastExecutedCell",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cellReexecuted",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"numCellsExecuted",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"notebook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lastBusySignal",{enumerable:!0,configurable:!0,writable:!0,value:""}),this.init()}async init(){await this.notebookPanel.revealed,this.notebook=this.notebookPanel.content,this.notebook.notebookConfig.recordTiming=!0,this.registerCells(),this.isReady.resolve(void 0)}registerMetadataChanges(e){if(!(e.id in this.cellSlotMap)){const t=()=>this.cellMetadataChanged(e);this.cellSlotMap[e.id]=t,e.metadata.changed.connect(t),this.cellMetadataChanged(e)}}deregisterMetadataChanges(e){const t=this.cellSlotMap[e.id];t&&e.metadata.changed.disconnect(t),delete this.cellSlotMap[e.id]}getCodeCellFromModel(e){return"code"===e.type?this.notebookPanel.content.widgets.find((t=>t.model===e)):null}cellMetadataChanged(e){const t=this.getCodeCellFromModel(e);if(t){const e=t.model.metadata.get("execution");e&&e["iopub.status.busy"]&&this.lastBusySignal!==e["iopub.status.busy"]&&(this.activeCell=t,this.cellReexecuted=this.lastExecutedCell===t,this.lastExecutedCell=t,this.numCellsExecuted+=1,this.lastBusySignal=e["iopub.status.busy"])}}registerCells(){const e=this.notebookPanel.context.model.cells;e.changed.connect(((e,t)=>{t.oldValues.forEach(this.deregisterMetadataChanges.bind(this)),t.newValues.forEach(this.registerMetadataChanges.bind(this))}));for(let t=0;t<e.length;t+=1)this.registerMetadataChanges(e.get(t))}getActiveCell(){return this.activeCell}getCellReexecuted(){return this.cellReexecuted}getNumCellsExecuted(){return this.numCellsExecuted}ready(){return this.isReady.promise}}var u=a(273),d=a(31);const m=(0,u.observer)((()=>{const e=(0,d.qL)(),t=(0,d.$q)(),a=e=>t.isCollapsed||t.view!==e?"":"tabbuttonactive",s="jobtabletabbuttonicon tabbutton "+a("jobs"),n="taskviewtabbuttonicon tabbutton "+a("taskchart"),l="timelinetabbuttonicon tabbutton "+a("timeline");return i().createElement("div",{className:"title"},i().createElement("div",{className:"titleleft"},i().createElement("span",{className:"tbitem titlecollapse ",onClick:()=>{t.toggleCollapseCellDisplay()}},i().createElement("span",{className:"headericon "+(t.isCollapsed?"headericoncollapsed":"")})),i().createElement("span",{className:"tbitem badgecontainer"},i().createElement("b",null," Apache Spark "),i().createElement("span",{className:"badgeexecutor"},i().createElement("span",{className:"badgeexecutorcount"},e.numExecutors)," EXECUTORS"),i().createElement("span",{className:"badgeexecutorcores"},i().createElement("span",{className:"badgeexecutorcorescount"},e.numTotalCores)," CORES"),i().createElement("b",null," Jobs "),i().createElement("span",{className:"badges"},t.numActiveJobs?i().createElement("span",{className:"badgerunning"},i().createElement("span",{className:"badgerunningcount"},t.numActiveJobs)," RUNNING"):"",t.numCompletedJobs?i().createElement("span",{className:"badgecompleted"},i().createElement("span",{className:"badgecompletedcount"},t.numCompletedJobs)," COMPLETED"):"",t.numFailedJobs?i().createElement("span",{className:"badgefailed"},i().createElement("span",{className:"badgefailedcount"},t.numFailedJobs)," FAILED"):""))),i().createElement("div",{className:"titleright"},i().createElement("div",{className:"tabbuttons"},i().createElement("span",{className:s,title:"Jobs",onClick:()=>{t.setView("jobs")}}),i().createElement("span",{className:n,title:"Tasks",onClick:()=>{t.setView("taskchart")}}),i().createElement("span",{className:l,title:"Event Timeline",onClick:()=>{t.setView("timeline")}}),i().createElement("span",{className:"closebuttonicon tabbutton",title:"Close Display",onClick:()=>{t.toggleHideCellDisplay()}}))))}));var b=a(851),h=a.n(b);const g=e=>i().createElement("div",{className:"tdjobitemprogress cssprogress"},i().createElement("div",{className:"data"},e.completed,"/",e.total,e.running>0?` (${e.running})`:""),i().createElement("span",{className:"val1",style:{width:1*e.completed/e.total*100+"%"}}),i().createElement("span",{className:"val2",style:{width:1*e.running/e.total*100+"%"}}));var p=a(115),k=a.n(p),v=a(265);const f=(0,u.observer)((e=>{var t;const a=(0,d.qL)().stages[e.stageId];return i().createElement("tr",{className:"stagerow"},i().createElement("td",{className:"tdstageid"},a.stageId),i().createElement("td",{className:"tdstagename"},a.name),i().createElement("td",{className:"tdstagestatus"},i().createElement("span",{className:a.status},a.status)),i().createElement("td",{className:"tdtasks"},i().createElement(g,{total:a.numTasks,running:a.numActiveTasks,completed:a.numCompletedTasks})),i().createElement("td",{className:"tdstagestarttime"},i().createElement(h(),{date:a.submissionTime,minPeriod:10})),i().createElement("td",{className:"tdstageduration"},a.completionTime?k()((null===(t=a.completionTime)||void 0===t?void 0:t.getTime())-a.submissionTime.getTime()):"-"))})),E=(0,u.observer)((e=>{const t=(0,d.qL)().jobs[e.jobId].uniqueStageIds.map((e=>i().createElement(f,{stageId:e,key:e})));return i().createElement("table",{className:"stagetable"},i().createElement("thead",null,i().createElement("tr",null,i().createElement("th",{className:"thstageid"},"ID"),i().createElement("th",{className:"thstagename"},"Stage"),i().createElement("th",{className:"thstagestatus"},"Status"),i().createElement("th",{className:"thstagetasks"},"Tasks"),i().createElement("th",{className:"thstagestart"},"Submission Time"),i().createElement("th",{className:"thstageduration"},"Duration"))),i().createElement("tbody",null,t))})),S=(0,u.observer)((e=>{var t;const a=(0,d.qL)(),s=null==a?void 0:a.jobs[e.jobId],[n,l]=i().useState(!0);return i().createElement(i().Fragment,null,i().createElement("tr",{className:"jobrow"},i().createElement("td",{className:"tdstagebutton",onClick:()=>{l((e=>!e))}},i().createElement("span",{className:"tdstageicon "+(n?"":"tdstageiconcollapsed")})),i().createElement("td",{className:"tdjobid"},s.jobId),i().createElement("td",{className:"tdjobname"},s.name),i().createElement("td",{className:"tdjobstatus"},i().createElement("span",{className:"tditemjobstatus "+s.status},s.status)),i().createElement("td",{className:"tdjobstages"},s.numCompletedStages,"/",s.numStages,s.numSkippedStages>0?`(${s.numSkippedStages} skipped)`:"",s.numActiveStages>0?`(${s.numActiveStages} active)`:""),i().createElement("td",{className:"tdtasks"},i().createElement(g,{total:s.numTasks,running:s.numActiveTasks,completed:s.numCompletedTasks})),i().createElement("td",{className:"tdjobstarttime"},i().createElement(h(),{date:s.startTime,minPeriod:10})),i().createElement("td",{className:"tdjobduration"},s.endTime?k()((null===(t=s.endTime)||void 0===t?void 0:t.getTime())-s.startTime.getTime()):"-")),!n&&i().createElement("tr",{className:"jobstagedatarow"},i().createElement("td",{className:"stagetableoffset"}),i().createElement("td",{colSpan:7,className:"stagedata"},i().createElement(E,{jobId:e.jobId}))))})),T=(0,u.observer)((()=>{const e=(0,d.$q)();return i().createElement(v.S,null,i().createElement("div",{className:"tabcontent"},i().createElement("table",{className:"jobtable"},i().createElement("thead",null,i().createElement("tr",null,i().createElement("th",{className:"thbutton"}),i().createElement("th",{className:"thjobid"},"ID"),i().createElement("th",{className:"thjobname"},"Job"),i().createElement("th",{className:"thjobstatus"},"Status"),i().createElement("th",{className:"thjobstages"},"Stages"),i().createElement("th",{className:"thjobtasks"},"Tasks"),i().createElement("th",{className:"thjobstart"},"Submission Time"),i().createElement("th",{className:"thjobtime"},"Duration"))),i().createElement("tbody",{className:"jobtablebody"},e.uniqueJobIds.map((e=>i().createElement(S,{jobId:e,key:e})))))))})),C=i().lazy((()=>Promise.all([a.e(232),a.e(397)]).then(a.bind(a,566)))),j=()=>i().createElement(o.Suspense,{fallback:i().createElement("div",null,"loading")},i().createElement(C,null)),w=i().lazy((()=>a.e(99).then(a.bind(a,446)))),y=()=>i().createElement(o.Suspense,{fallback:i().createElement("div",null,"loading")},i().createElement(w,null)),I=(0,u.observer)((()=>{var e;const t=(0,d.qL)(),a=(0,d.$q)();if(!a||(null===(e=null==a?void 0:a.uniqueJobIds)||void 0===e?void 0:e.length)<=0||a.isRemoved||(null==t?void 0:t.hideAllDisplays))return i().createElement("div",{className:"sparkMonitorCellRoot"});let s=i().createElement(i().Fragment,null);return a.isCollapsed||"jobs"!==(null==a?void 0:a.view)?a.isCollapsed||"taskchart"!==(null==a?void 0:a.view)?a.isCollapsed||"timeline"!==(null==a?void 0:a.view)||(s=i().createElement(j,null)):s=i().createElement(y,null):s=i().createElement(T,null),i().createElement("div",{className:"sparkMonitorCellRoot CellMonitor pm"},i().createElement(m,null),i().createElement("div",{className:"content"},s))})),P=(0,u.observer)((e=>i().createElement(d.ey.Provider,{value:d.h.notebooks[e.notebookId]},i().createElement(d.A0.Provider,{value:d.h.notebooks[e.notebookId].cells[e.cellId]},i().createElement(I,null)))));var N=a(538);class O{constructor(e,t){var a,s,n;Object.defineProperty(this,"notebookPanel",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"notebookStore",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"currentCellTracker",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cellExecCountSinceSparkJobStart",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"kernel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"comm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.createCellReactElements(),this.currentCellTracker=new c(e),this.kernel=e.session?this.notebookPanel.session.kernel:null===(a=this.notebookPanel.sessionContext.session)||void 0===a?void 0:a.kernel,this.startComm(),null===(s=this.kernel)||void 0===s||s.statusChanged.connect(((e,t)=>{"starting"===t&&(this.currentCellTracker.cellReexecuted=!1,this.startComm())})),null===(n=this.notebookPanel.content.model)||void 0===n||n.cells.changed.connect(((e,a)=>{"remove"===a.type&&a.oldValues.forEach((e=>{t.onCellRemoved(e.id)}))}))}createCellReactElements(){const e=e=>{if("code"===e.type){const t=this.notebookPanel.content.widgets.find((t=>t.model===e));if(t&&!t.node.querySelector(".sparkMonitorCellRoot")){const a=N.ReactWidget.create(i().createElement(P,{notebookId:this.notebookPanel.id,cellId:e.id}));a.addClass("SparkMonitorCellWidget"),t.layout.insertWidget(2,a),t.update()}}},t=this.notebookPanel.context.model.cells;t.changed.connect(((t,a)=>{for(let a=0;a<t.length;a+=1)e(t.get(a))}));for(let a=0;a<t.length;a+=1)e(t.get(a))}toggleAll(){this.notebookStore.toggleHideAllDisplays()}startComm(){console.log("SparkMonitor: Starting Comm with kernel."),this.currentCellTracker.ready().then((()=>{var e;this.comm="createComm"in(this.kernel||{})?null===(e=this.kernel)||void 0===e?void 0:e.createComm("SparkMonitor"):this.kernel.connectToComm("SparkMonitor"),this.comm?(this.comm.open({msgtype:"openfromfrontend"}),this.comm.onMsg=e=>{this.handleMessage(e)},this.comm.onClose=e=>{},console.log("SparkMonitor: Connection with comms established")):console.warn("SparkMonitor: Unable to connect to comm")}))}onSparkJobStart(e){const t=this.currentCellTracker.getActiveCell();t?(this.currentCellTracker.getNumCellsExecuted()>this.cellExecCountSinceSparkJobStart&&(this.cellExecCountSinceSparkJobStart=this.currentCellTracker.getNumCellsExecuted(),this.notebookStore.onCellExecutedAgain(t.model.id)),this.notebookStore.onSparkJobStart(t.model.id,e)):console.warn("SparkMonitor: Job started with no running cell.")}onSparkStageSubmitted(e){const t=this.currentCellTracker.getActiveCell();t?this.notebookStore.onSparkStageSubmitted(t.model.id,e):console.warn("SparkMonitor: Stage started with no running cell.")}handleMessage(e){if(e.content.data.msgtype||console.warn("SparkMonitor: Unknown message"),"fromscala"===e.content.data.msgtype){const t=JSON.parse(e.content.data.msg);switch(t.msgtype){case"sparkJobStart":this.onSparkJobStart(t);break;case"sparkJobEnd":this.notebookStore.onSparkJobEnd(t);break;case"sparkStageSubmitted":this.onSparkStageSubmitted(t);break;case"sparkStageCompleted":this.notebookStore.onSparkStageCompleted(t);break;case"sparkStageActive":this.notebookStore.onSparkStageActive(t);break;case"sparkTaskStart":this.notebookStore.onSparkTaskStart(t);break;case"sparkTaskEnd":this.notebookStore.onSparkTaskEnd(t);break;case"sparkApplicationStart":this.notebookStore.onSparkApplicationStart(t);break;case"sparkApplicationEnd":break;case"sparkExecutorAdded":this.notebookStore.onSparkExecutorAdded(t);break;case"sparkExecutorRemoved":this.notebookStore.onSparkExecutorRemoved(t);break;default:console.warn("SparkMonitor: Unknown message")}}}}var D=a(414);class A{constructor(){Object.defineProperty(this,"uniqueId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"uniqueJobId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cellId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stageId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numTasks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numActiveTasks",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"numCompletedTasks",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"numFailedTasks",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"submissionTime",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"completionTime",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),(0,D.makeAutoObservable)(this)}}class x{constructor(e){Object.defineProperty(this,"notebookStore",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"uniqueId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cellId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"jobId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:"RUNNING"}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"unnamed"}),Object.defineProperty(this,"startTime",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"endTime",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stageIds",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"uniqueStageIds",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"numStages",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"numTasks",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"numActiveTasks",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"numCompletedTasks",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"numFailedTasks",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"cell",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),(0,D.makeAutoObservable)(this)}get numActiveStages(){return this.uniqueStageIds.filter((e=>"PENDING"===this.notebookStore.stages[e].status)).length}get numCompletedStages(){return this.uniqueStageIds.filter((e=>"COMPLETED"===this.notebookStore.stages[e].status)).length}get numFailedStages(){return this.uniqueStageIds.filter((e=>"FAILED"===this.notebookStore.stages[e].status)).length}get numSkippedStages(){return this.uniqueStageIds.filter((e=>"SKIPPED"===this.notebookStore.stages[e].status)).length}}class q{constructor(e){Object.defineProperty(this,"notebookStore",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"jobDataX",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"jobDataY",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"jobDataText",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"executorDataX",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"executorDataY",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"taskDataX",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"taskDataY",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"numActiveTasks",{enumerable:!0,configurable:!0,writable:!0,value:0})}addExecutorData(e,t){this.executorDataX.push(e),this.executorDataY.push(t)}addTaskData(e,t){this.taskDataX.push(new Date(e).getTime()),this.taskDataY.push(t),this.addExecutorData(new Date(e).getTime(),this.notebookStore.numTotalCores||0)}onSparkJobStart(e){const t=new Date(e.submissionTime).getTime();this.jobDataX.push(t),this.jobDataY.push(0),this.jobDataText.push(`Job ${e.jobId} started`),this.addExecutorData(t,e.totalCores)}onSparkJobEnd(e){const t=new Date(e.completionTime).getTime();this.jobDataX.push(t),this.jobDataY.push(0),this.jobDataText.push(`Job ${e.jobId} ended`)}onSparkTaskStart(e){this.addTaskData(e.launchTime,this.numActiveTasks),this.numActiveTasks+=1,this.addTaskData(e.launchTime,this.numActiveTasks)}onSparkTaskEnd(e){this.addTaskData(e.finishTime,this.numActiveTasks),this.numActiveTasks-=1,this.addTaskData(e.finishTime,this.numActiveTasks)}}class J{constructor(e,t){Object.defineProperty(this,"cellId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"notebookStore",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"view",{enumerable:!0,configurable:!0,writable:!0,value:"jobs"}),Object.defineProperty(this,"isCollapsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isRemoved",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"uniqueJobIds",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"taskChartStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),(0,D.makeAutoObservable)(this),this.taskChartStore=new q(this.notebookStore)}toggleCollapseCellDisplay(){this.isCollapsed=!this.isCollapsed}toggleHideCellDisplay(){this.isRemoved=!this.isRemoved}setView(e){this.view=e,this.isCollapsed=!1,this.isRemoved=!1}get jobs(){return this.uniqueJobIds.map((e=>this.notebookStore.jobs[e]))}get numActiveJobs(){return this.jobs.filter((e=>"RUNNING"===e.status)).length}get numFailedJobs(){return this.jobs.filter((e=>"FAILED"===e.status)).length}get numCompletedJobs(){return this.jobs.filter((e=>"COMPLETED"===e.status)).length}get numTotalJobs(){return this.uniqueJobIds.length}}class M{constructor(e){Object.defineProperty(this,"notebookPanelId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"numExecutors",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numTotalCores",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"applicationName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"applicationId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"applicationAttemptId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"uniqueId",{enumerable:!0,configurable:!0,writable:!0,value:"default-key"}),Object.defineProperty(this,"hideAllDisplays",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"cells",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"jobs",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"stages",{enumerable:!0,configurable:!0,writable:!0,value:{}}),(0,D.makeAutoObservable)(this)}toggleHideAllDisplays(){this.hideAllDisplays=!this.hideAllDisplays}onSparkApplicationStart(e){this.applicationId=e.appId,this.applicationName=e.appName,this.applicationAttemptId=e.appAttemptId,this.uniqueId=`app${this.applicationId}-attempt${this.applicationAttemptId}`}deleteCellData(e){const t=this.cells[e];t&&(t.uniqueJobIds.forEach((e=>{const t=this.jobs[e];t&&(t.uniqueStageIds.forEach((e=>{this.stages[e]&&delete this.stages[e]})),delete this.jobs[e])})),delete this.cells[e])}onCellRemoved(e){this.deleteCellData(e)}onCellExecutedAgain(e){this.deleteCellData(e),this.cells[e]=new J(e,this)}onSparkJobStart(e,t){this.numTotalCores=t.totalCores,this.numExecutors=t.numExecutors;const a=new x(this);if(a.uniqueId=`${this.uniqueId}-job-${t.jobId}`,a.jobId=t.jobId,a.status=t.status,a.cellId=e,a.name=String(t.name).split(" ")[0],a.startTime=new Date(t.submissionTime),a.stageIds=t.stageIds,a.numStages=t.stageIds.length,a.numTasks=t.numTasks,t.stageIds.forEach((e=>{const s=`${this.uniqueId}-stage-${e}`;let n=this.stages[s];n||(n=new A,n.status="PENDING",this.stages[s]=n),n.uniqueJobId=a.uniqueId,n.numTasks=t.stageInfos[e].numTasks,n.name=t.stageInfos[e].name,a.uniqueStageIds.push(s)})),"null"===a.name){const e=Math.max.apply(null,t.stageIds);a.name=this.stages[`${this.uniqueId}-stage-${e}`].name}this.cells[e]||(this.cells[e]=new J(e,this)),this.cells[e].uniqueJobIds.push(a.uniqueId),a.cell=this.cells[e],a.cell.taskChartStore.onSparkJobStart(t),this.jobs[a.uniqueId]=a}onSparkJobEnd(e){var t;const a=`${this.uniqueId}-job-${e.jobId}`,s=this.jobs[a];s?(s.status=e.status,s.endTime=new Date(e.completionTime),s.uniqueStageIds.forEach((e=>{var t;"PENDING"===(null===(t=this.stages[e])||void 0===t?void 0:t.status)&&(this.stages[e].status="SKIPPED",s.numTasks-=this.stages[e].numTasks)})),null===(t=s.cell)||void 0===t||t.taskChartStore.onSparkJobEnd(e)):console.warn("SparkMonitor: Could not identify job")}onSparkStageSubmitted(e,t){const a=-1===t.submissionTime?new Date:new Date(t.submissionTime),s=`${this.uniqueId}-stage-${t.stageId}`;this.stages[s]||(this.stages[s]=new A,this.stages[s].uniqueId=s);const n=this.stages[s];n.cellId=e,n.stageId=t.stageId,n.status="RUNNING",n.name=String(t.name).split(" ")[0],n.submissionTime=a,n.numTasks=t.numTasks}onSparkStageCompleted(e){const t=`${this.uniqueId}-stage-${e.stageId}`,a=this.stages[t];if(a){a.status=e.status,a.completionTime=new Date(e.completionTime),a.submissionTime=new Date(e.submissionTime),a.numActiveTasks=0,a.numCompletedTasks=e.numCompletedTasks,a.numFailedTasks=e.numFailedTasks,a.numTasks=e.numTasks;const t=this.jobs[a.uniqueJobId];t&&(t.numActiveTasks=0,t.numCompletedTasks=0,t.numFailedTasks=0,t.numTasks=0,t.uniqueStageIds.forEach((e=>{var a,s,n,l;t.numActiveTasks+=(null===(a=this.stages[e])||void 0===a?void 0:a.numActiveTasks)||0,t.numCompletedTasks+=(null===(s=this.stages[e])||void 0===s?void 0:s.numCompletedTasks)||0,t.numFailedTasks+=(null===(n=this.stages[e])||void 0===n?void 0:n.numFailedTasks)||0,t.numTasks+=(null===(l=this.stages[e])||void 0===l?void 0:l.numTasks)||0})))}else console.warn("SparkMonitor: Unable to identify stage")}onSparkExecutorAdded(e){this.numTotalCores=e.totalCores,this.numExecutors||(this.numExecutors=0),this.numExecutors+=1}onSparkExecutorRemoved(e){this.numTotalCores=e.totalCores,this.numExecutors||(this.numExecutors=0),this.numExecutors-=1}onSparkTaskStart(e){var t;const a=`${this.uniqueId}-stage-${e.stageId}`,s=this.stages[a];if(s){const a=s.uniqueJobId,n=this.jobs[a];n&&(null===(t=n.cell)||void 0===t||t.taskChartStore.onSparkTaskStart(e))}}onSparkTaskEnd(e){var t;const a=`${this.uniqueId}-stage-${e.stageId}`,s=this.stages[a];if(s){const a=s.uniqueJobId,n=this.jobs[a];n&&(null===(t=n.cell)||void 0===t||t.taskChartStore.onSparkTaskEnd(e))}}onSparkStageActive(e){const t=`${this.uniqueId}-stage-${e.stageId}`,a=this.stages[t];if(a&&"RUNNING"===a.status){a.numActiveTasks=e.numActiveTasks,a.numCompletedTasks=e.numCompletedTasks,a.numFailedTasks=e.numFailedTasks;const t=this.jobs[a.uniqueJobId];t&&(t.numActiveTasks=0,t.numCompletedTasks=0,t.numFailedTasks=0,t.numTasks=0,t.uniqueStageIds.forEach((e=>{var a,s,n,l;t.numActiveTasks+=(null===(a=this.stages[e])||void 0===a?void 0:a.numActiveTasks)||0,t.numCompletedTasks+=(null===(s=this.stages[e])||void 0===s?void 0:s.numCompletedTasks)||0,t.numFailedTasks+=(null===(n=this.stages[e])||void 0===n?void 0:n.numFailedTasks)||0,t.numTasks+=(null===(l=this.stages[e])||void 0===l?void 0:l.numTasks)||0})))}}}const R={id:"jupyterlab_sparkmonitor",autoStart:!0,requires:[s.INotebookTracker,n.IMainMenu],activate(e,t,a){let s;console.log("JupyterLab SparkMonitor is activated!"),t.widgetAdded.connect((async(e,t)=>{var a;let n,l,o=d.h.notebooks[t.id];if(o||(o=new M(t.id),d.h.notebooks[t.id]=o),t.session)await t.session.ready,n=t.session.kernel,await n.ready,l=n.info;else{const{sessionContext:e}=t;await e.ready,n=null===(a=e.session)||void 0===a?void 0:a.kernel,l=await(null==n?void 0:n.info)}"python"===l.language_info.name&&(s=new O(t,o),console.log("Notebook kernel ready"),s.startComm())}));const n="toggle-monitor";let o=!1;e.commands.addCommand(n,{label:"Hide Spark Monitoring",isEnabled:()=>!0,isVisible:()=>!0,isToggled:()=>o,execute:()=>{console.log(`Executed ${n}`),o=!o,null==s||s.toggleAll()}});const i=new l.Menu({commands:e.commands});i.title.label="Spark",i.addItem({command:n,args:{}}),a.addMenu(i,{rank:40})}}},31:(e,t,a)=>{a.d(t,{h:()=>o,ey:()=>i,A0:()=>r,qL:()=>c,$q:()=>u});var s=a(271),n=a.n(s),l=a(414);const o=new class{constructor(){Object.defineProperty(this,"notebooks",{enumerable:!0,configurable:!0,writable:!0,value:{}}),(0,l.makeAutoObservable)(this)}},i=(n().createContext(o),n().createContext(void 0)),r=n().createContext(void 0),c=()=>n().useContext(i),u=()=>n().useContext(r)}}]);