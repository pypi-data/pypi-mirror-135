(globalThis.webpackChunkjupyhai=globalThis.webpackChunkjupyhai||[]).push([[4],{9004:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>he});var a,o=n(6674),r=n(1538),i=n(3706),s=n(6271),c=n.n(s),l=n(4456);function u(e,t){window.dispatchEvent(new CustomEvent(e,{detail:t}))}!function(e){e.Execute="jupyhai_execute",e.ShowSettings="jupyhai_show_settings",e.ShowLogs="jupyhai_show_logs"}(a||(a={}));var d=n(4446);const g=(e,t)=>e===t,p={};var m=n(8991),f=n.n(m);function h(e,t){const n=e.endsWith("/")?"":"/";return e+n+(t?t.replace(/^\/+/,""):"")}function v(){let e=window.location.origin;const t=document.body;if(t){const n=t.getAttribute("data-base-url");n&&(e=h(e,n))}return e}const y=h(v(),"jupyhai"),E=f().create({baseURL:y,xsrfCookieName:"_xsrf",xsrfHeaderName:"X-XSRFToken"}),b=E;async function x(e){return(await E.get(e)).data}var j;async function w(e){const t={project_id:e.configuration.projectId||"",environment_id:e.configuration.environmentId||"",title:e.configuration.title||"",image:e.configuration.image||"",ignore:e.configuration.ignore||"",mounts:e.configuration.mounts||[]};await b.post("/settings",t)}!function(e){e[e.LoggedOut=0]="LoggedOut",e[e.LoggedIn=1]="LoggedIn",e[e.LoggingIn=2]="LoggingIn"}(j||(j={}));const O={loginStatus:j.LoggedOut,loginError:void 0,notebookInstanceId:void 0,hostFlavor:void 0,username:void 0,defaultHost:void 0,preparingExecutionCounter:0,preparingExecutionEvents:[],preparingExecutionFailed:!1,executionsFetched:!1,executions:{},executionEvents:{},configuration:{projectId:void 0,environmentId:void 0,image:"",title:"",ignore:[],mounts:[]}};function k(e,t){switch(t.type){case"loadPersistedState":{const{persistedState:n}=t;return function(e,t,n){let a=t;return n.forEach((t=>{null!==t&&(a=e(a,t))})),a}(k,e,[n.loginStatus===j.LoggedIn&&n.hostFlavor?{type:"loginSuccess",hostFlavor:n.hostFlavor,username:n.username}:null,n.configuration?{type:"changeConfiguration",configuration:n.configuration}:null,n.defaultHost?{type:"changeDefaultHost",defaultHost:n.defaultHost}:null])}case"logout":return Object.assign(Object.assign({},e),{executions:{},executionEvents:{},executionsFetched:!1,preparingExecutionCounter:0,preparingExecutionEvents:[],preparingExecutionFailed:!1,hostFlavor:void 0,loginStatus:j.LoggedOut,loginError:void 0,username:void 0});case"loginAttemptStarted":return Object.assign(Object.assign({},e),{hostFlavor:void 0,loginStatus:j.LoggingIn});case"loginSuccess":return Object.assign(Object.assign({},e),{executions:{},executionEvents:{},executionsFetched:!1,preparingExecutionCounter:0,preparingExecutionEvents:[],preparingExecutionFailed:!1,hostFlavor:t.hostFlavor,loginStatus:j.LoggedIn,loginError:void 0,username:t.username});case"loginFailed":return Object.assign(Object.assign({},e),{loginStatus:j.LoggedOut,loginError:t.error});case"changeProject":{const n=Object.assign(Object.assign({},e),{executions:{},executionEvents:{},executionsFetched:!1,preparingExecutionCounter:0,preparingExecutionEvents:[],preparingExecutionFailed:!1,configuration:Object.assign(Object.assign({},e.configuration),{projectId:t.projectId})});return w(n),n}case"changeConfiguration":{const n=Object.assign(Object.assign({},e),{configuration:t.configuration});return w(n),n}case"changeDefaultHost":return Object.assign(Object.assign({},e),{defaultHost:t.defaultHost});case"startPreparingExecution":return Object.assign(Object.assign({},e),{preparingExecutionEvents:[],preparingExecutionCounter:t.currentMaxCounter+1,preparingExecutionFailed:!1});case"addPreparingExecutionEvent":return Object.assign(Object.assign({},e),{preparingExecutionEvents:[...e.preparingExecutionEvents,t.event]});case"preparingExecutionFailed":return Object.assign(Object.assign({},e),{preparingExecutionFailed:!0});case"executionsFetched":return Object.assign(Object.assign({},e),{executionsFetched:!0});case"updateExecution":if(t.projectId===e.configuration.projectId){const{id:n}=t.execution;return Object.assign(Object.assign({},e),{executions:Object.assign(Object.assign({},e.executions),{[n]:t.execution})})}return e;case"updateExecutionEvents":{const{id:n}=t;return Object.assign(Object.assign({},e),{executionEvents:Object.assign(Object.assign({},e.executionEvents),{[n]:t.events})})}default:throw new Error}}const C=e=>{S.set((t=>k(t,e)))},S=function(e,t){let n=[],a=e;function o(e,o){const r=a;a=e instanceof Function?e(a):e,setTimeout((()=>{var e;n.forEach((e=>e(a))),null==o||o(a),null===(e=void 0)||void 0===e||e.call(t,a,r)}))}function r(e){return n.push(e),()=>{n=n.filter((t=>t!==e))}}function i(){const[e,t]=(0,s.useState)(a);var n;return n=t,(0,s.useLayoutEffect)((()=>r(n)),[n]),[e,o]}return{use:i,useSelector:function(e,t=g){const[n]=i();return function(e,t=g){const n=(0,s.useRef)(p);let a=n.current;return(0,s.useLayoutEffect)((()=>{n.current=a})),n.current!==p&&t(e,n.current)||(a=e),a}(e(n),t)},useValue:()=>i()[0],get:()=>a,set:o,reset:()=>o(e),subscribe:r}}(O),N=()=>S.useValue(),I=()=>C;var L=n(3195),F=n.n(L);function P(e){return Object.values(e).reduce(((e,{counter:t})=>Math.max(t,e)),0)}function A(e){return"complete"===(t=e.status)||"error"===t||"stopped"===t;var t}const R=()=>{const e=I(),t=N(),[n,o]=s.useState(!1),{configuration:r,executions:i,loginStatus:c}=t;s.useEffect((()=>{!async function(e){const t=await async function(){const e=await b.get("/login"),{logged_in:t,notebook_instance_id:n,username:a,host_flavor:o,default_host:r}=e.data,i=await b.get("/settings"),{environment:s,project:c,image:l,title:u,ignore:d,mounts:g}=i.data.result;return{loginStatus:t?j.LoggedIn:j.LoggedOut,notebookInstanceId:n,hostFlavor:o,defaultHost:r,username:a,configuration:{projectId:c,environmentId:s,image:l,title:u,ignore:d,mounts:g}}}();t&&e({type:"loadPersistedState",persistedState:t})}(e)}),[e]);const l=s.useCallback(((t,n,a)=>e({type:"addPreparingExecutionEvent",event:{message:t,time:(new Date).toTimeString(),stream:n,tags:a}})),[e]),g=s.useCallback((async t=>{if(!n)if(c===j.LoggedIn&&r.projectId&&r.image){o(!0),e({type:"startPreparingExecution",currentMaxCounter:P(i)});try{await async function(e,t){var n,o,r;try{if(e("Saving notebook..."),window.Jupyter&&window.Jupyter.notebook)await window.Jupyter.notebook.save_checkpoint();else{if(!t)throw Error("Missing jupyter lab details");t.save()}e("Done.");const{notebookPath:n,notebookJSON:o}=function(e){if(window.Jupyter)return{notebookPath:window.Jupyter.notebook.notebook_path,notebookJSON:window.Jupyter.notebook.toJSON()};if(e)return{notebookPath:e.path,notebookJSON:e.json};throw new Error("Can't get notebook data")}(t),r={type:"notebook",content:o};e("Calculating Valohai execution package size...");const i=await b.get("/prepare",{params:{notebook_path:n}}),{fileCount:s,totalUncompressedSize:c}=i.data;if(!(s>-1))throw e("Trying to package too many files! Execution aborted.","stderr",void 0),e("Do NOT start the notebook server from a large folder like home (~/).","stderr",void 0),e("Use the settings window to ignore files to make the package smaller.","stderr",void 0),new Error("Trying to package too many files.");e(`Package size: ${s} files, ${F()(c)}`),e("Preparing Valohai execution package...");const l=await b.post("/prepare",{path:n,content:r}),{commit:u}=l.data;e(`Creating execution with ${u}...`);const d=await b.post("/execute",{commit:u,content:r}),{execution:g}=d.data;t&&function(e,t){const n=new CustomEvent(a.ShowLogs,{detail:{id:e,counter:t}});window.dispatchEvent(n)}(g.id,g.counter),e(`Done â€“ ${g.id}`)}catch(t){throw e(`FAILED: ${(null===(r=null===(o=null===(n=t.response)||void 0===n?void 0:n.data)||void 0===o?void 0:o.error)||void 0===r?void 0:r.message)||t}`,"stderr",void 0),console.error(t),t}}(l,t)}catch(t){e({type:"preparingExecutionFailed"})}finally{o(!1)}}else u(a.ShowSettings)}),[l,n,r,i,c,e]);return(0,d.useEvent)(a.Execute,(e=>{g(e.detail)})),s.createElement(s.Fragment,null)},_=({items:e})=>{const t=c().useRef(null),[n,a]=c().useState(!0),o=c().useCallback((()=>{a(!1)}),[]),r=c().useCallback((e=>{a(e.target.checked)}),[]);return c().useLayoutEffect((()=>{n&&t.current&&t.current.scrollTo(0,Number.MAX_SAFE_INTEGER)}),[n,e.length]),c().createElement(c().Fragment,null,c().createElement("div",{className:"jupyhai-console-output",ref:t,onWheel:o},e.map((e=>{let t;switch(e.stream){case"stderr":t="jupyhai-console-warning";break;case"status":t="jupyhai-console-info";break;default:t=""}return c().createElement("div",{className:t,key:`${e.time}${e.stream||""}${e.message}`},e.message)}))),c().createElement("label",{style:{paddingLeft:"10px"}},c().createElement("input",{type:"checkbox",checked:n,onChange:r})," Autoscroll"))};function $({events:e}){const[t,n]=c().useState(0);(0,d.useInterval)((()=>n((e=>e+1))),1e3);const a=c().useMemo((()=>void 0===e?null:(e||[]).filter((e=>e.message.length>0))),[e]);return a?a.length?c().createElement(_,{items:a}):c().createElement("div",{className:"jupyhai-console-output"},"Execution has not generated any output yet."):c().createElement("div",{className:"jupyhai-console-output"},function(e,t){let n=".";for(let e=0;e<(t+2)%3;e++)n+=".";return`loading${n}`}(0,t))}var M=n(1572),T=n.n(M);const H=({executionId:e})=>{const t=N(),{executions:n}=t,a=function(e,t){var n,a;const o=`/events/${e}`;return null!==(a=null===(n=T()(`/events/${e}`,(async()=>(await b.get(o)).data),t).data)||void 0===n?void 0:n.results)&&void 0!==a?a:void 0}(e,{refreshInterval:e in n&&A(n[e])?2500:1500});return s.createElement($,{events:a})};var V=n(9129);class D{createNew(e,t){const n=new r.ToolbarButton({className:"run-remote-button",label:"Run Remote",onClick:()=>{const n={json:t.model.toJSON(),path:e.context.sessionContext.path,save:()=>t.createCheckpoint()};u(a.Execute,n)},tooltip:"Run Remote"});return e.toolbar.insertItem(10,"runRemote",n),new V.DisposableDelegate((()=>{n.dispose()}))}}var J=n(6662),U=n(1700),W=n.n(U);const z=({visible:e,className:t,style:n})=>e?c().createElement("img",{className:`jupyhai-spinner ${t||""}`,alt:"Loading",style:n}):null;n(6348);var X=n(2184),B=n.n(X);c().forwardRef(((e,t)=>{var{className:n,children:a}=e,o=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n}(e,["className","children"]);return c().createElement("div",Object.assign({ref:t,role:"tooltip"},o,{className:B()("tooltip",n)}),c().createElement("div",{className:"tooltip-arrow"}),c().createElement("div",{className:"tooltip-inner"},a))})),f().create({baseURL:h(v(),"api"),xsrfCookieName:"_xsrf",xsrfHeaderName:"X-XSRFToken"});const G={complete:"fa-check-circle",error:"fa-exclamation-circle",stopped:"fa-stop",stopping:"fa-pause",started:"fa-play",created:"fa-ellipsis-h",queued:"fa-circle",preparing:"fa-circle",failed:"fa-circle"};var q=n(5889);const K=new(n.n(q)())({concurrency:2});const Q=({execution:e})=>s.createElement("tr",null,s.createElement("td",null,e.counter),s.createElement("td",null,s.createElement("span",{className:`jupyhai-execution-text-${e.status}`},s.createElement("i",{className:`fa ${G[e.status]||""}`,style:{display:"inline"}}),"Â ",W()(e.status))),s.createElement("td",null,(0,J.formatDistanceToNow)((0,J.parseISO)(e.ctime)).replace("months","mo")," ago"),s.createElement("td",null,e.duration),s.createElement("td",null,s.createElement("button",{type:"button",className:"jupyhai-button",onClick:()=>(e=>{const t=new CustomEvent(a.ShowLogs,{detail:e});window.dispatchEvent(t)})({counter:e.counter,id:e.id})},"Logs"),s.createElement("button",{type:"button",className:"jupyhai-button",onClick:async()=>async function(e,t){let n=`${e.urls.display}${t}`;const a=await b.get(`/execution-url-with-token/${e.id}`);a.data.url&&(n=`${a.data.url}${t}`),window.open(n,"_blank")}(e,"")},"Open in Valohai"))),Y=()=>{const{configuration:{projectId:e},executionsFetched:t,executions:n,executionEvents:a}=N(),o=I(),r=s.useMemo((()=>new Set(Object.keys(a))),[a]),i=s.useCallback((()=>{e&&async function(e,t){let n={};try{n=await async function(){var e,t;try{const e=await b.get("/executions"),t={};return e.data.results.forEach((e=>{t[e.id]=e})),t}catch(n){if("no_project"===(null===(t=null===(e=n.response)||void 0===e?void 0:e.data.error)||void 0===t?void 0:t.code))return null;throw n}}()}finally{e({type:"executionsFetched"})}if(null===n)return null;Object.values(n).forEach((t=>e({type:"updateExecution",projectId:t.project,execution:t})));const a=(o=n,new Set(Object.keys(o).filter((e=>A(o[e])))));var o,r;(r=n,Object.values(r).sort(((e,t)=>t.counter-e.counter)).slice(0,30)).forEach((n=>{const{id:o}=n;if(!t.has(o)||!a.has(o)){const t=a.has(o)?0:1;!async function(e,t,n){K.add((async()=>{const n=await b.get(`/events/${t}`);e({type:"updateExecutionEvents",id:t,events:n.data.results})}),{priority:n})}(e,o,t)}}))}(o,r)}),[o,r,e]);(0,d.useInterval)(i,t?3e3:50);const c=Object.values(n).sort(((e,t)=>e.counter>t.counter?-1:1)).slice(0,10);return s.createElement("div",{style:{overflow:"auto"}},s.createElement("h2",{style:{padding:"1em"}},"Latest Executions"),s.createElement("table",{style:{paddingLeft:"1em",width:"90%"}},s.createElement("tr",null,s.createElement("th",{style:{textAlign:"left"}},"Counter"),s.createElement("th",{style:{textAlign:"left"}},"Status"),s.createElement("th",{style:{textAlign:"left"}},"Created at"),s.createElement("th",{style:{textAlign:"left"}},"Duration"),s.createElement("th",{style:{textAlign:"left"}},"Actions")),c.map((e=>s.createElement(Q,{execution:e})))))};function Z(e){var{className:t}=e,n=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n}(e,["className"]);return c().createElement("label",Object.assign({},n,{className:B()("control-label",t)}))}function ee(e){var{className:t}=e,n=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n}(e,["className"]);return c().createElement("input",Object.assign({},n,{className:B()("form-control",t)}))}const te=({environmentId:e,environments:t,onChange:n})=>{const a=Array.from(t||[]).sort(((e,t)=>e.name<t.name?-1:1)).map((e=>c().createElement("option",{key:e.id,value:e.id},e.name)));let o="undefined";return t?e?o=e:a.unshift(c().createElement("option",{key:"undefined",value:"undefined",disabled:!0},"[Select Environment]")):a.unshift(c().createElement("option",{key:"undefined",value:"undefined",disabled:!0},"[Loading...]")),c().createElement("select",{value:o,className:"form-control jupyhai-select jupyhai-text-field",placeholder:"select",onChange:e=>n(e.target.value)},a)},ne=({mount:e,onChange:t,onRemove:n})=>{const a=c().useCallback((n=>{const{name:a}=n.target.dataset;switch(a){case"source":case"destination":t(Object.assign(Object.assign({},e),{[a]:n.target.value}));break;case"readonly":t(Object.assign(Object.assign({},e),{[a]:n.target.checked}))}}),[e,t]);return c().createElement("tr",null,c().createElement("td",{className:"jupyhai-table-cell"},c().createElement(ee,{type:"text",className:"jupyhai-table-text-field",value:e.source,"data-name":"source",onChange:a})),c().createElement("td",{className:"jupyhai-table-cell"},c().createElement(ee,{type:"text",className:"jupyhai-table-text-field",value:e.destination,"data-name":"destination",onChange:a})),c().createElement("td",{className:"jupyhai-table-cell",style:{textAlign:"center",paddingRight:0,width:50}},c().createElement(ee,{type:"checkbox",className:"jupyhai-table-checkbox",checked:e.readonly,"data-name":"readonly",onChange:a})),c().createElement("td",{className:"jupyhai-table-cell",style:{paddingLeft:10,paddingRight:0}},c().createElement("button",{className:"btn",type:"button",onClick:n},c().createElement("i",{className:"fa fa-trash"}))))},ae=({mounts:e,onChange:t})=>{const n=e.map(((n,a)=>c().createElement(ne,{mount:n,key:a,onChange:n=>function(n,a){const o=[...e];o[n]=a,t(o)}(a,n),onRemove:()=>function(n){const a=[...e];a.splice(n,1),t(a)}(a)})));return c().createElement(c().Fragment,null,c().createElement("table",{className:"table jupyhai-table"},c().createElement("thead",null,c().createElement("tr",null,c().createElement("th",{className:"jupyhai-table-header"},"Source"),c().createElement("th",{className:"jupyhai-table-header"},"Destination"),c().createElement("th",{className:"jupyhai-table-header"},"Read only"))),c().createElement("tbody",null,n)),c().createElement("a",{onClick:function(){const n=e.concat({destination:"/to/path",source:"/from/path",readonly:!1});t(n)},className:"jupyhai-cursor-pointer"},c().createElement("i",{className:"fa fa-plus"}),"Â Add Mount"))},oe=({projects:e,projectId:t,onChange:n})=>{const a=Array.from(e||[]).sort(((e,t)=>e.name<t.name?-1:1)).map((e=>c().createElement("option",{key:e.id,value:e.id},e.name)));let o="undefined";return e?t?o=t:a.unshift(c().createElement("option",{key:"undefined",value:"undefined",disabled:!0},"[Select Project]")):a.unshift(c().createElement("option",{key:"undefined",value:"undefined",disabled:!0},"[Loading...]")),c().createElement("select",{value:o,className:"form-control jupyhai-select jupyhai-text-field",placeholder:"select",onChange:e=>n(e.target.value)},a)};function re(){window.open("https://app.valohai.com/projects/create")}function ie(e){return e.ignore?e.ignore.filter((e=>e.length>0)):[]}const se=()=>{var e,t;const[n,a]=s.useState(0),[o,r]=(0,s.useState)(0),{configuration:i,notebookInstanceId:c,hostFlavor:l}=N(),u=I(),d=null===(e=T()("/environments",x).data)||void 0===e?void 0:e.results,g=null===(t=T()("/projects",x).data)||void 0===t?void 0:t.results,p=s.useCallback((e=>{u({type:"changeProject",projectId:e})}),[u]),m=s.useCallback((e=>{u({type:"changeConfiguration",configuration:Object.assign(Object.assign({},i),{environmentId:e})})}),[i,u]),f=s.useCallback((e=>{u({type:"changeConfiguration",configuration:Object.assign(Object.assign({},i),{mounts:e})})}),[i,u]),h=s.useCallback((e=>{u({type:"changeConfiguration",configuration:Object.assign(Object.assign({},i),{image:e})})}),[i,u]),v=s.useCallback((e=>{u({type:"changeConfiguration",configuration:Object.assign(Object.assign({},i),{title:e})})}),[i,u]),y=s.useCallback((async()=>{var e,t,n;const o=await b.get("/prepare",{params:{ignore:JSON.stringify(ie(i)),notebook_path:null!==(n=null===(t=null===(e=window.Jupyter)||void 0===e?void 0:e.notebook)||void 0===t?void 0:t.notebook_path)&&void 0!==n?n:"."}});a(o.data.fileCount),r(o.data.totalUncompressedSize)}),[i]),E=s.useCallback((e=>{const t=e.target.value.split("\n");u({type:"changeConfiguration",configuration:Object.assign(Object.assign({},i),{ignore:t})}),y()}),[i,u,y]);s.useEffect((()=>{y()}),[y,u]),s.useEffect((()=>{(!i.projectId||g&&!g.some((e=>e.id===i.projectId)))&&g&&g.length>0&&p(g[0].id),(!i.environmentId||d&&!d.some((e=>e.id===i.environmentId)))&&d&&d.length>0&&m(d[0].id)}),[i,d,g,m,p]);const j=n<0||o<0?s.createElement("p",{className:"text-danger jupyhai-sizeinfo"},"Warning: Execution will be too large! Try ignoring files or change your root folder."):s.createElement("p",{className:"text-muted jupyhai-sizeinfo"},n," files, ",F()(o));let w=s.createElement(oe,{projectId:void 0,projects:void 0,onChange:p,onNewProject:re});if(g){const e=g.find((e=>e.id===i.projectId));w=c?s.createElement("div",null,s.createElement(ee,{className:"jupyhai-text-field",value:e?e.name:"Set by notebook",disabled:!0})):s.createElement(oe,{projectId:e?e.id:void 0,projects:g,onChange:p,onNewProject:re})}return s.createElement("form",{className:"form jupyhai-form"},s.createElement("div",{className:"form-group"},"minihai"!==l&&s.createElement(s.Fragment,null,s.createElement(Z,null,"Project"),w,s.createElement(Z,null,"Environment"),s.createElement(te,{environmentId:i.environmentId,environments:d||void 0,onChange:m})),s.createElement(Z,null,"Docker Image"),s.createElement(ee,{type:"text",className:"jupyhai-text-field",value:i.image,onChange:e=>h(e.target.value)}),s.createElement(Z,null,"Ignore"),s.createElement("textarea",{className:"form-control jupyhai-text-field",value:i.ignore?i.ignore.join("\n"):"",onChange:E}),j,"minihai"!==l&&s.createElement(s.Fragment,null,s.createElement(Z,null,"Title"),s.createElement(ee,{type:"text",className:"jupyhai-text-field",value:i.title,onChange:e=>v(e.target.value)})),s.createElement(Z,null,"Mounts"),s.createElement(ae,{mounts:i.mounts||[],onChange:f})))};var ce=n(4439);const le=({flavor:e,onLogin:t})=>{const n=I(),{loginStatus:a,loginError:o,defaultHost:r}=N(),[i,c]=(0,s.useState)(""),[l,u]=(0,s.useState)(""),[d,g]=(0,s.useState)((()=>"minihai"===e?"":r||"")),[p,m]=(0,s.useState)(""),[f,h]=(0,s.useState)(!1),v=s.useCallback((async a=>{let o;if(a.preventDefault(),p&&"valohai"===e)o=await async function(e,t){return(await b.post("/login",{token:e,hostUrl:t})).data}(p,d);else{if(!i||!l)return;o=await async function(e,t,n){return(await b.post("/login",{username:e,password:t,hostUrl:n})).data}(i,l,d)}o.success?(n({type:"loginSuccess",hostFlavor:e,username:i}),t()):(n({type:"loginFailed",error:o.error||void 0}),h(!0))}),[e,n,t,l,p,i,d]),y=s.useCallback((e=>{switch(e.target.name){case"username":c(e.target.value);break;case"password":u(e.target.value);break;case"token":m(e.target.value);break;case"hostUrl":g(e.target.value)}e.stopPropagation()}),[]);return s.createElement("form",{className:"form jupyhai-form",style:{padding:"15px"}},s.createElement("div",{style:{border:"1px solid lightgray",padding:"12px"}},s.createElement(Z,null,"Username"),s.createElement(ee,{type:"text",name:"username",className:"jupyhai-text-field",autoFocus:!0,value:i,placeholder:"minihai"===e?"sharky":"",onChange:y}),s.createElement(Z,null,"Password"),s.createElement(ee,{type:"password",name:"password",className:"jupyhai-text-field",value:l,placeholder:"minihai"===e?"12345":"",onChange:y}),s.createElement("p",{style:{textAlign:"center",width:"100%"}},"or"),s.createElement(Z,null,"API Token"),s.createElement(ee,{type:"text",name:"token",className:"jupyhai-text-field",value:p,disabled:"minihai"===e,onChange:y})),s.createElement("div",{style:{padding:"12px"}},s.createElement(Z,null,"Host URL"),s.createElement(ee,{type:"text",name:"hostUrl",className:"jupyhai-text-field",value:d,onChange:y}),f&&s.createElement("div",{className:"alert alert-danger"},o||"Login has failed for an unknown reason."),s.createElement("button",{onClick:v,type:"submit",className:"btn btn-default jupyhai-button"},"Login"),s.createElement(z,{visible:a===j.LoggingIn}),s.createElement("a",{className:"jupyhai-login-info"},"What is ",(0,ce.capitalize)(e),"?")))},ue=({loginStatus:e,username:t})=>{const n=I(),a=s.useCallback((async()=>{await b.post("/logout"),n({type:"logout"})}),[n]);return e===j.LoggedIn?s.createElement("div",{style:{padding:"2em"}},"ðŸ‘‹",t?s.createElement(s.Fragment,null," ","Hello, ",s.createElement("b",null,t),"!"):s.createElement(s.Fragment,null," Hello!"),s.createElement("button",{className:"jupyhai-button",type:"button",style:{marginLeft:"1em"},onClick:a},"Log out")):s.createElement(le,{onLogin:()=>console.log("Logged in"),flavor:"valohai"})},de=()=>{const{loginStatus:e,username:t}=N();return s.createElement("div",null,s.createElement("h2",{style:{padding:"1em"}},"Valohai Settings"),s.createElement(ue,{loginStatus:e,username:t}),e===j.LoggedIn&&s.createElement(se,null))},ge="valohai:settings",pe="valohai:executions",me="valohai:runremote";class fe{constructor(e,t){this.openExecutionsView=()=>{this.activateOrCreatePanelWithComponent("valohai-executions","Valohai Executions",s.createElement(Y,null))},this.openSettingsPanel=()=>{this.activateOrCreatePanelWithComponent("valohai-settings","Valohai Settings",s.createElement(de,null))},this.openLogPanel=(e,t)=>{this.activateOrCreatePanelWithComponent(`valohai-log-${e}`,`Valohai Execution #${t}`,s.createElement(H,{executionId:e}),"down")},this.openLogs=e=>{e.detail&&this.openLogPanel(e.detail.id,e.detail.counter)},this.app=e,this.mainMenu=t}activateOrCreatePanelWithComponent(e,t,n,a="main"){if(document.getElementById(e))return void this.app.shell.activateById(e);const o=function(e,t){const n=new i.Widget,a=new r.MainAreaWidget({content:n});return a.id=e,a.title.label=t,a.title.closable=!0,{page:a,content:n}}(e,t);l.render(n,o.content.node),function(e,t,n="main"){const a=t.page;a.isAttached||e.shell.add(a,n),e.shell.activateById(a.id)}(this.app,o,a)}configureCommands(){const{app:e}=this;e.docRegistry.addWidgetExtension("Notebook",new D),e.contextMenu.addItem({command:me,selector:".jp-Notebook"}),e.commands.addCommand(pe,{label:"Valohai Executions",execute:this.openExecutionsView}),e.commands.addCommand(ge,{label:"Valohai Settings",execute:this.openSettingsPanel}),e.commands.addCommand(me,{label:"Valohai Run Remote",execute:()=>u(a.Execute)})}configureMainMenu(){const{mainMenu:e}=this;e.settingsMenu.addGroup([{command:ge}],2),e.viewMenu.addGroup([{command:pe},{command:"valohai:logs"}],2)}boot(){this.configureCommands(),this.configureMainMenu(),this.configureEventListeners(),function(){const e=new i.Widget;l.render(s.createElement(R,null),e.node)}(),console.log("JupyterLab extension jupyhai is activated!")}configureEventListeners(){window.addEventListener(a.ShowSettings,this.openSettingsPanel),window.addEventListener(a.Execute,this.openExecutionsView),window.addEventListener(a.ShowLogs,(e=>this.openLogs(e)))}}const he={id:"jupyhai:plugin",autoStart:!0,requires:[o.IMainMenu],activate:(e,t)=>{new fe(e,t).boot()}}},2705:(e,t,n)=>{var a=n(5639).Symbol;e.exports=a},9932:e=>{e.exports=function(e,t){for(var n=-1,a=null==e?0:e.length,o=Array(a);++n<a;)o[n]=t(e[n],n,e);return o}},4286:e=>{e.exports=function(e){return e.split("")}},4239:(e,t,n)=>{var a=n(2705),o=n(9607),r=n(2333),i=a?a.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":i&&i in Object(e)?o(e):r(e)}},4259:e=>{e.exports=function(e,t,n){var a=-1,o=e.length;t<0&&(t=-t>o?0:o+t),(n=n>o?o:n)<0&&(n+=o),o=t>n?0:n-t>>>0,t>>>=0;for(var r=Array(o);++a<o;)r[a]=e[a+t];return r}},531:(e,t,n)=>{var a=n(2705),o=n(9932),r=n(1469),i=n(3448),s=a?a.prototype:void 0,c=s?s.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(r(t))return o(t,e)+"";if(i(t))return c?c.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n}},180:(e,t,n)=>{var a=n(4259);e.exports=function(e,t,n){var o=e.length;return n=void 0===n?o:n,!t&&n>=o?e:a(e,t,n)}},8805:(e,t,n)=>{var a=n(180),o=n(2689),r=n(3140),i=n(9833);e.exports=function(e){return function(t){t=i(t);var n=o(t)?r(t):void 0,s=n?n[0]:t.charAt(0),c=n?a(n,1).join(""):t.slice(1);return s[e]()+c}}},1957:(e,t,n)=>{var a="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g;e.exports=a},9607:(e,t,n)=>{var a=n(2705),o=Object.prototype,r=o.hasOwnProperty,i=o.toString,s=a?a.toStringTag:void 0;e.exports=function(e){var t=r.call(e,s),n=e[s];try{e[s]=void 0;var a=!0}catch(e){}var o=i.call(e);return a&&(t?e[s]=n:delete e[s]),o}},2689:e=>{var t=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");e.exports=function(e){return t.test(e)}},2333:e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},5639:(e,t,n)=>{var a=n(1957),o="object"==typeof self&&self&&self.Object===Object&&self,r=a||o||Function("return this")();e.exports=r},3140:(e,t,n)=>{var a=n(4286),o=n(2689),r=n(676);e.exports=function(e){return o(e)?r(e):a(e)}},676:e=>{var t="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",n="\\ud83c[\\udffb-\\udfff]",a="[^\\ud800-\\udfff]",o="(?:\\ud83c[\\udde6-\\uddff]){2}",r="[\\ud800-\\udbff][\\udc00-\\udfff]",i="(?:"+t+"|"+n+")?",s="[\\ufe0e\\ufe0f]?",c=s+i+"(?:\\u200d(?:"+[a,o,r].join("|")+")"+s+i+")*",l="(?:"+[a+t+"?",t,o,r,"[\\ud800-\\udfff]"].join("|")+")",u=RegExp(n+"(?="+n+")|"+l+c,"g");e.exports=function(e){return e.match(u)||[]}},1469:e=>{var t=Array.isArray;e.exports=t},7005:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},3448:(e,t,n)=>{var a=n(4239),o=n(7005);e.exports=function(e){return"symbol"==typeof e||o(e)&&"[object Symbol]"==a(e)}},9833:(e,t,n)=>{var a=n(531);e.exports=function(e){return null==e?"":a(e)}},1700:(e,t,n)=>{var a=n(8805)("toUpperCase");e.exports=a}}]);