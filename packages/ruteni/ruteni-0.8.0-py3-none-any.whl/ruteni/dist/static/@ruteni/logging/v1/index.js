var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var o,n,r,i={exports:{}};n=e,r=function(){var e=function(){},t="undefined",o=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"];function r(e,t){var o=e[t];if("function"==typeof o.bind)return o.bind(e);try{return Function.prototype.bind.call(o,e)}catch(t){return function(){return Function.prototype.apply.apply(o,[e,arguments])}}}function i(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function a(n){return"debug"===n&&(n="log"),typeof console!==t&&("trace"===n&&o?i:void 0!==console[n]?r(console,n):void 0!==console.log?r(console,"log"):e)}function l(t,o){for(var r=0;r<n.length;r++){var i=n[r];this[i]=r<t?e:this.methodFactory(i,t,o)}this.log=this.debug}function c(e,o,n){return function(){typeof console!==t&&(l.call(this,o,n),this[e].apply(this,arguments))}}function s(e,t,o){return a(e)||c.apply(this,arguments)}function u(e,o,r){var i,a=this;o=null==o?"WARN":o;var c="loglevel";function u(){var e;if(typeof window!==t&&c){try{e=window.localStorage[c]}catch(e){}if(typeof e===t)try{var o=window.document.cookie,n=o.indexOf(encodeURIComponent(c)+"=");-1!==n&&(e=/^([^;]+)/.exec(o.slice(n))[1])}catch(e){}return void 0===a.levels[e]&&(e=void 0),e}}"string"==typeof e?c+=":"+e:"symbol"==typeof e&&(c=void 0),a.name=e,a.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},a.methodFactory=r||s,a.getLevel=function(){return i},a.setLevel=function(o,r){if("string"==typeof o&&void 0!==a.levels[o.toUpperCase()]&&(o=a.levels[o.toUpperCase()]),!("number"==typeof o&&o>=0&&o<=a.levels.SILENT))throw"log.setLevel() called with invalid level: "+o;if(i=o,!1!==r&&function(e){var o=(n[e]||"silent").toUpperCase();if(typeof window!==t&&c){try{return void(window.localStorage[c]=o)}catch(e){}try{window.document.cookie=encodeURIComponent(c)+"="+o+";"}catch(e){}}}(o),l.call(a,o,e),typeof console===t&&o<a.levels.SILENT)return"No console available for logging"},a.setDefaultLevel=function(e){o=e,u()||a.setLevel(e,!1)},a.resetLevel=function(){a.setLevel(o,!1),function(){if(typeof window!==t&&c){try{return void window.localStorage.removeItem(c)}catch(e){}try{window.document.cookie=encodeURIComponent(c)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}()},a.enableAll=function(e){a.setLevel(a.levels.TRACE,e)},a.disableAll=function(e){a.setLevel(a.levels.SILENT,e)};var f=u();null==f&&(f=o),a.setLevel(f,!1)}var f=new u,p={};f.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=p[e];return t||(t=p[e]=new u(e,f.getLevel(),f.methodFactory)),t};var v=typeof window!==t?window.log:void 0;return f.noConflict=function(){return typeof window!==t&&window.log===f&&(window.log=v),f},f.getLoggers=function(){return p},f.default=f,f},(o=i).exports?o.exports=r():n.log=r();var a=i.exports,l={exports:{}};!function(t){!function(e,o){t.exports?t.exports=o():e.prefix=o(e)}(e,(function(e){var t,o,n={template:"[%t] %l:",levelFormatter:function(e){return e.toUpperCase()},nameFormatter:function(e){return e||"root"},timestampFormatter:function(e){return e.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1")},format:void 0},r={},i={reg:function(e){if(!e||!e.getLogger)throw new TypeError("Argument is not a root logger");t=e},apply:function(e,o){if(!e||!e.setLevel)throw new TypeError("Argument is not a logger");var i=e.methodFactory,a=e.name||"",l=r[a]||r[""]||n;return r[a]||(e.methodFactory=function(e,t,o){var n=i(e,t,o),l=r[o]||r[""],c=-1!==l.template.indexOf("%t"),s=-1!==l.template.indexOf("%l"),u=-1!==l.template.indexOf("%n");return function(){for(var t="",i=arguments.length,f=Array(i),p=0;p<i;p++)f[p]=arguments[p];if(a||!r[o]){var v=l.timestampFormatter(new Date),g=l.levelFormatter(e),d=l.nameFormatter(o);l.format?t+=l.format(g,d,v):(t+=l.template,c&&(t=t.replace(/%t/,v)),s&&(t=t.replace(/%l/,g)),u&&(t=t.replace(/%n/,d))),f.length&&"string"==typeof f[0]?f[0]=t+" "+f[0]:f.unshift(t)}n.apply(void 0,f)}}),(o=o||{}).template&&(o.format=void 0),r[a]=function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(t in arguments[o])Object.prototype.hasOwnProperty.call(arguments[o],t)&&(e[t]=arguments[o][t]);return e}({},l,o),e.setLevel(e.getLevel()),t||e.warn("It is necessary to call the function reg() of loglevel-plugin-prefix before calling apply. From the next release, it will throw an error. See more: https://github.com/kutuluk/loglevel-plugin-prefix/blob/master/README.md"),e}};return e&&(o=e.prefix,i.noConflict=function(){return e.prefix===i&&(e.prefix=o),i}),i}))}(l);var c=l.exports,s={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=window;if(!n)throw new Error("Plugin for browser usage only");var r=void 0;function i(e){try{return JSON.stringify(e)}catch(e){if(!r)try{var t={};t.a=t,JSON.stringify(t)}catch(e){r=e.message}if(e.message===r)return"[Circular]";throw e}}function a(e){if(!Object.getOwnPropertyDescriptor||!Object.getPrototypeOf)return Object.prototype.toString.call(e).slice(8,-1);for(;e;){var t=Object.getOwnPropertyDescriptor(e,"constructor");if(void 0!==t&&"function"==typeof t.value&&""!==t.value.name)return t.value.name;e=Object.getPrototypeOf(e)}return""}function l(e){var t="",o=0;return e.length>1&&"string"==typeof e[0]&&(t=(t=e[0].replace(/(%?)(%([sdjo]))/g,(function(t,n,r,l){if(!n){var c=e[o+=1],s="";switch(l){case"s":s+=c;break;case"d":s+=+c;break;case"j":s=i(c);break;case"o":var u=i(c);"{"!==u[0]&&"["!==u[0]&&(u="<"+u+">"),s=a(c)+u}return s}return t}))).replace(/%{2,2}/g,"%"),o+=1),e.length>o&&(t&&(t+=" "),t+=e.slice(o).join(" ")),t}var c=Object.prototype.hasOwnProperty;function s(){for(var e={},t=0;t<arguments.length;t+=1){var n=Object(arguments[t]);for(var r in n)c.call(n,r)&&(e[r]="object"!==o(n[r])||Array.isArray(n[r])?n[r]:s(e[r],n[r]))}return e}function u(){try{throw new Error}catch(e){return e.stack}}function f(e){var t=this,o=[],n=[];this.length=function(){return o.length},this.sent=function(){return n.length},this.push=function(t){o.push(t),o.length>e&&o.shift()},this.send=function(){return n.length||(n=o,o=[]),n},this.confirm=function(){n=[],t.content=""},this.fail=function(){var r=1+o.length+n.length-e;r>0&&(n.splice(0,r),o=n.concat(o),t.confirm())}}var p=!!u(),v=void 0,g=void 0,d=void 0;function y(e){return"["+e.timestamp+"] "+e.level.label.toUpperCase()+(e.logger?" ("+e.logger+")":"")+": "+e.message+(e.stacktrace?"\n"+e.stacktrace:"")}function m(e){return e.level=e.level.label,e}function h(){throw new Error("You can't set token for a not appled plugin")}var w=n.remote,b=500,k={url:"/logger",method:"POST",headers:{},token:"",onUnauthorized:function(){},timeout:0,interval:1e3,level:"trace",backoff:{multiplier:2,jitter:.1,limit:3e4},capacity:0,stacktrace:{levels:["trace","warn","error"],depth:3,excess:0},timestamp:function(){return(new Date).toISOString()},format:y},x={noConflict:function(){return n.remote===x&&(n.remote=w),x},plain:y,json:m,apply:function(e,t){if(!e||!e.getLogger)throw new TypeError("Argument is not a root loglevel object");if(v)throw new Error("You can assign a plugin only one time");if(!n.XMLHttpRequest)return e;v=e;var r=s(k,t);r.capacity=r.capacity||b;var i=r.backoff,a="object"===(void 0===i?"undefined":o(i))?function(e){var t=e*i.multiplier;return t>i.limit&&(t=i.limit),t+=t*i.jitter*Math.random()}:i,y=r.interval,m=void 0,h=void 0,w=!1,L=!1,O=new f(r.capacity);function j(){if(!L&&!w&&void 0!==r.token){if(!O.sent()){if(!O.length())return;var e=O.send();O.content=h?'{"logs":['+e.join(",")+"]}":e.join("\n")}w=!0;var t=new n.XMLHttpRequest;t.open(r.method,r.url,!0),t.setRequestHeader("Content-Type",m),r.token&&t.setRequestHeader("Authorization","Bearer "+r.token);var o=r.headers;for(var i in o)if(c.call(o,i)){var l=o[i];l&&t.setRequestHeader(i,l)}var s=void 0;r.timeout&&(s=n.setTimeout((function(){w=!1,t.abort(),u()}),r.timeout)),t.onreadystatechange=function(){if(4===t.readyState)if(w=!1,n.clearTimeout(s),200===t.status)y=r.interval,O.confirm(),u(!0);else{if(401===t.status){var e=r.token;r.token=void 0,r.onUnauthorized(e)}u()}},t.send(O.content)}function u(e){e||(y=a(y||1),O.fail()),L=!0,n.setTimeout((function(){L=!1,j()}),y)}}return g=e.methodFactory,d=function(e,t,o){var n=g(e,t,o),i=p&&r.stacktrace.levels.some((function(t){return t===e})),a=v.levels[e.toUpperCase()],c=a>=v.levels[r.level.toUpperCase()];return function(){for(var t=arguments.length,s=Array(t),f=0;f<t;f++)s[f]=arguments[f];if(c){var p=r.timestamp(),g=i?u():"";if(g){var d=g.split("\n");d.splice(0,r.stacktrace.excess+3);var y=r.stacktrace.depth;y&&d.length!==y+1?(g=d.splice(0,y).join("\n"),d.length&&(g+="\n    and "+d.length+" more")):g=d.join("\n")}var w=r.format({message:l(s),level:{label:e,value:a},logger:o||"",timestamp:p,stacktrace:g});void 0===h&&(m=(h="string"!=typeof w)?"application/json":"text/plain");var b="";if(h)try{b+=JSON.stringify(w)}catch(e){return n.apply(void 0,s),void v.getLogger("logger").error(e)}else b+=w;O.push(b),j()}n.apply(void 0,s)}},e.methodFactory=d,e.setLevel(e.getLevel()),x.setToken=function(e){r.token=e,j()},e},disable:function(){if(!v)throw new Error("You can't disable a not appled plugin");if(d!==v.methodFactory)throw new Error("You can't disable a plugin after appling another plugin");v.methodFactory=g,v.setLevel(v.getLevel()),v=void 0,x.setToken=h},setToken:h};t.default=x,e.exports=t.default}(s,s.exports);var u=t(s.exports);c.reg(a),c.apply(a,{template:"[%n] %l:",levelFormatter:e=>e.toUpperCase(),nameFormatter:e=>e||"root"});const f={url:"/api/logging/v1/log",method:"POST",headers:{},token:"",onUnauthorized:e=>{},timeout:0,interval:1e3,level:"warn",backoff:{multiplier:2,jitter:.1,limit:3e4},capacity:500,stacktrace:{levels:["trace","warn","error"],depth:3,excess:0},timestamp:()=>(new Date).toISOString(),format:u.json};u.apply(a,f);a.getLogger("loglevel").debug("initialized");const p={prefix:c,remote:u};export{a as default,p as plugins};
